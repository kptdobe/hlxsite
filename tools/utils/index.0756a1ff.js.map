{"mappings":"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","sources":["src/pp/pp.ui.js","src/pp/pp.js"],"sourcesContent":["import { initOptionFields, attachOptionFieldsListeners } from '../fields.js';\nimport { preview, publish } from './pp.js';\n\nconst PARENT_SELECTOR = '.pp';\nconst PREVIEW_BUTTON = document.querySelector(`${PARENT_SELECTOR} #previewButton`);\nconst PUBLISH_BUTTON = document.querySelector(`${PARENT_SELECTOR} #publishButton`);\nconst PP_BUTTON = document.querySelector(`${PARENT_SELECTOR} #ppButton`);\nconst OPERATION_STATUS_PANEL = document.getElementById('ppStatus');\nconst OPERATION_RESULTS_PANEL = document.getElementById('ppResults');\n\nconst config = {};\n\nconst getURLs = () => {\n  return config.fields.ppURLs.split('\\n').map(e => e.trim());\n}\n\nconst clear = () => {\n  OPERATION_STATUS_PANEL.innerHTML = '';\n  OPERATION_RESULTS_PANEL.innerHTML = '';\n};\n\nconst updateStatus = (operation, counter, total) => {\n  let bar = OPERATION_STATUS_PANEL.querySelector('sp-progress-bar');\n  let div = OPERATION_STATUS_PANEL.querySelector('div');\n  if (!bar) {\n    bar = document.createElement('sp-progress-bar');\n    bar.setAttribute('size', 'm');\n    bar.setAttribute('label', `${operation} in progress...`);\n    OPERATION_STATUS_PANEL.appendChild(bar);\n    div = document.createElement('div');\n    OPERATION_STATUS_PANEL.appendChild(div);\n  }\n\n  if (counter === total) {\n    bar.setAttribute('label', `${operation} done.`);\n  }\n  bar.setAttribute('progress', Math.floor(100 * counter / total));\n  div.innerHTML = `${operation}: ${counter} / ${total}`;\n};\n\nconst displayResult = (operation, counter, url) => {\n    const p = document.createElement('p');\n    p.innerHTML = `${counter} / ${operation}: `\n    const link = document.createElement('sp-link');\n    link.setAttribute('size', 'm');\n    link.setAttribute('target', '_blank');\n    link.setAttribute('href', url);\n    link.innerHTML = url;\n    p.append(link);\n    OPERATION_RESULTS_PANEL.appendChild(p);\n}\n\nconst disableButtons = () => {\n  PREVIEW_BUTTON.setAttribute('disabled', 'true');\n  PUBLISH_BUTTON.setAttribute('disabled', 'true');\n  PP_BUTTON.setAttribute('disabled', 'true');\n}\n\nconst enableButtons = () => {\n  PREVIEW_BUTTON.removeAttribute('disabled');\n  PUBLISH_BUTTON.removeAttribute('disabled');\n  PP_BUTTON.removeAttribute('disabled');\n}\n\nconst doPreview = async () => {\n  const urls = getURLs();\n  await preview(urls, (url, operation, counter, total, adminURL, json) => {\n    updateStatus('Preview', counter, total);\n    displayResult('Preview', counter, json.preview.url);\n  });\n}\n\nconst doPublish = async () => {\n  const urls = getURLs();\n  await publish(urls, (url, operation, counter, total, adminURL, json) => {\n    updateStatus('Publish', counter, total);\n    displayResult('Publish', counter, json.live.url);\n  });\n}\n\nconst attachListeners = () => {\n  attachOptionFieldsListeners(config.fields, PARENT_SELECTOR);\n\n  PREVIEW_BUTTON.addEventListener('click', async () => {\n    disableButtons();\n    clear();\n    await doPreview();\n    enableButtons();\n  });\n  PUBLISH_BUTTON.addEventListener('click', async () => {\n    disableButtons();\n    clear();\n    await doPublish(); \n    enableButtons();\n  });\n  PP_BUTTON.addEventListener('click', async () => {\n    disableButtons();\n    clear();\n    await doPreview();\n    await doPublish();\n    enableButtons();\n  });\n}\n\nconst init = () => {\n  config.fields = initOptionFields(PARENT_SELECTOR);\n\n  attachListeners();\n};\n\ninit();\n","import { toHelixConfig } from '../utils.js';\n\nconst PREVIEW_CONCURRENCY = 5;\nconst PUBLISH_CONCURRENCY = 40;\n\nconst run = async (urls, operation, onOperation) => {\n  const total = urls.length;\n  let counter = 0;\n\n  const executeOperation = async (url) => {\n    const hlx = toHelixConfig(url);\n    const adminURL = `https://admin.hlx.page/${operation}/${hlx.owner}/${hlx.repo}/${hlx.ref}${hlx.path}`;\n    const resp = await fetch(adminURL, {\n        method: 'POST',\n    }); \n    const json = await resp.json();\n    counter += 1;\n    if (onOperation) {\n      onOperation.call(null, url, operation, counter, total, adminURL, json);\n    }\n  }\n\n  const dequeue = async () => {\n    while (urls.length) {\n      const url = urls.shift();\n      await executeOperation(url);    \n    }\n  };\n\n  const concurrency = operation === 'live' ? PUBLISH_CONCURRENCY : PREVIEW_CONCURRENCY;\n  const promises = [];\n  for (let i = 0; i < concurrency; i += 1) {\n    promises.push(dequeue());\n  }\n  await Promise.all(promises);\n};\n\nconst preview = async (urls, onOperation) => {\n  await run(urls, 'preview', onOperation);\n};\n\nconst publish = async (urls, onOperation) => {\n  await run(urls, 'live', onOperation);\n};\n\nexport {\n  preview,\n  publish,\n};\n"],"names":["$3eT87","parcelRequire","$baa6D","$6a5b1c6ac671ec2a$var$run","async","urls","operation","onOperation","total","length","counter","executeOperation","url","hlx","toHelixConfig","adminURL","owner","repo","ref","path","resp","fetch","method","json","call","dequeue","shift","concurrency","promises","i","push","Promise","all","$2030d54ec0381895$var$PREVIEW_BUTTON","document","querySelector","$2030d54ec0381895$var$PUBLISH_BUTTON","$2030d54ec0381895$var$PP_BUTTON","$2030d54ec0381895$var$OPERATION_STATUS_PANEL","getElementById","$2030d54ec0381895$var$OPERATION_RESULTS_PANEL","$2030d54ec0381895$var$config","$2030d54ec0381895$var$getURLs","fields","ppURLs","split","map","e","trim","$2030d54ec0381895$var$clear","innerHTML","$2030d54ec0381895$var$updateStatus","bar","div","createElement","setAttribute","appendChild","Math","floor","$2030d54ec0381895$var$displayResult","p","link","append","$2030d54ec0381895$var$disableButtons","$2030d54ec0381895$var$enableButtons","removeAttribute","$2030d54ec0381895$var$doPreview","$6a5b1c6ac671ec2a$export$48c2d0f2f545ac27","preview","$2030d54ec0381895$var$doPublish","$6a5b1c6ac671ec2a$export$89b472e03be495df","live","initOptionFields","attachOptionFieldsListeners","addEventListener"],"version":3,"file":"index.0756a1ff.js.map"}